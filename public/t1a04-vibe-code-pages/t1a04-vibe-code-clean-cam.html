<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barebones Snake Game</title>
</head>
<body>
    <h1>Snake Game</h1>
    <span>Score: <span id="score">0</span></span>
    <span>High Score: <span id="high-score">0</span></span>
    <canvas id="gameCanvas" width="400" height="400" style="border: 1px solid black;"></canvas>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreSpan = document.getElementById('score');
        const highScoreSpan = document.getElementById('high-score');

        const gridSize = 20;
        let snake = [{ x: 10, y: 15 }];
        let food = {};
        let direction = { x: 0, y: 0 };
        let score = 0;
        let walls = [];
        let wallsEnabled = true; // Walls are always on in this version
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameLoopId;
        let gameSpeed = 150;
        let snakeColor = 'green';
        let isGameOver = false;
        let lastUpdateTime = 0;

        highScoreSpan.textContent = highScore;

        function getNewPosition() {
            let newPos = {
                x: Math.floor(Math.random() * (canvas.width / gridSize)),
                y: Math.floor(Math.random() * (canvas.height / gridSize))
            };
            
            const occupied = [...snake, food, ...walls].filter(p => p);

            for (const tile of occupied) {
                if (tile.x === newPos.x && tile.y === newPos.y) {
                    return getNewPosition();
                }
            }
            return newPos;
        }

        function generateFood() {
            const foodPosition = getNewPosition();
            food = {
                x: foodPosition.x,
                y: foodPosition.y,
                isGold: false,
                isRotten: false,
                isTiny: false,
                isOrange: false,
                isSpecial: false
            };

            const foodTypeRoll = Math.random();

            if (score >= 30) {
                if (foodTypeRoll < 0.05) {
                    food.isGold = true;
                } else if (foodTypeRoll < 0.10) {
                    food.isOrange = true;
                } else if (foodTypeRoll < 0.20) {
                    food.isTiny = true;
                } else if (foodTypeRoll < 0.30) {
                    if (Math.random() < 0.5) {
                        food.isRotten = true;
                    } else {
                        food.isSpecial = true;
                    }
                }
            } else if (score >= 15) {
                if (foodTypeRoll < 0.1) {
                    food.isTiny = true;
                } else if (foodTypeRoll < 0.2) {
                     if (Math.random() < 0.5) {
                        food.isRotten = true;
                    } else {
                        food.isSpecial = true;
                    }
                }
            } else if (score >= 5) {
                if (foodTypeRoll < 0.1) {
                     if (Math.random() < 0.5) {
                        food.isRotten = true;
                    } else {
                        food.isSpecial = true;
                    }
                }
            }
        }
        
        function generateWall() {
            const wallPosition = getNewPosition();
            walls.push(wallPosition);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (wallsEnabled) {
                 ctx.fillStyle = '#1a1a1a';
                 walls.forEach(wall => {
                     ctx.fillRect(wall.x * gridSize, wall.y * gridSize, gridSize, gridSize);
                 });
            }

            ctx.fillStyle = snakeColor;
            snake.forEach(segment => {
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
            });

            if (food.isGold) {
                ctx.fillStyle = '#FFD700';
            } else if (food.isRotten) {
                ctx.fillStyle = '#7f8c8d';
            } else if (food.isTiny) {
                ctx.fillStyle = '#ff69b4';
            } else if (food.isOrange) {
                ctx.fillStyle = '#FFA500';
            } else if (food.isSpecial) {
                ctx.fillStyle = '#4d96ff';
            }
            else {
                ctx.fillStyle = '#e74c3c';
            }
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize, gridSize);
        }

        function update() {
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            if (head.x < 0 || head.x >= canvas.width / gridSize || head.y < 0 || head.y >= canvas.height / gridSize) {
                gameOver();
                return;
            }

            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver();
                    return;
                }
            }
            
            if (wallsEnabled) {
                for (const wall of walls) {
                    if (head.x === wall.x && head.y === wall.y) {
                        gameOver();
                        return;
                    }
                }
            }

            snake.unshift(head);
            let foodEaten = false;

            if (head.x === food.x && head.y === food.y) {
                if (food.isRotten) {
                    score -= 1;
                } else if (food.isGold) {
                    score += 5;
                } else if (food.isTiny) {
                    score += 1;
                    if (snake.length > 1) {
                        snake.pop(); 
                    }
                    if (snake.length > 1) {
                         snake.pop();
                    }
                } else if (food.isOrange) {
                    score -= 5;
                } else if (food.isSpecial) {
                    score += 3;
                }
                else {
                    score += 1;
                }
                scoreSpan.textContent = score;
                generateFood();
                foodEaten = true;
            }
            else {
                snake.pop();
            }
            
            if (score > 0 && score % 5 === 0 && score > 0) {
                generateWall();
            }

            if (snake.length <= 0) {
                gameOver();
                return;
            }

            if (foodEaten) {
                if (score % 5 === 0 && gameSpeed > 50) {
                    gameSpeed -= 10;
                }
            }

            draw();
        }

        function gameLoop(timestamp) {
            const deltaTime = timestamp - lastUpdateTime;
            if (deltaTime > gameSpeed) {
                lastUpdateTime = timestamp;
                update();
            }

            gameLoopId = requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            cancelAnimationFrame(gameLoopId);
            isGameOver = true;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreSpan.textContent = highScore;
                console.log(`Game Over! New High Score: ${highScore}`);
            } else {
                console.log(`Game Over! Your Score: ${score}`);
            }
            initGame();
        }

        function handleKeyPress(event) {
            if (isGameOver) {
                return;
            }

            const key = event.key;
            
            switch (key) {
                case 'ArrowUp':
                    if (direction.y === 0) direction = { x: 0, y: -1 };
                    break;
                case 'ArrowDown':
                    if (direction.y === 0) direction = { x: 0, y: 1 };
                    break;
                case 'ArrowLeft':
                    if (direction.x === 0) direction = { x: -1, y: 0 };
                    break;
                case 'ArrowRight':
                    if (direction.x === 0) direction = { x: 1, y: 0 };
                    break;
            }
            
            if (direction.x !== 0 || direction.y !== 0) {
                if (!gameLoopId) {
                    gameLoop();
                }
            }
        }

        function initGame() {
            snake = [{ x: 10, y: 15 }];
            direction = { x: 0, y: 0 };
            score = 0;
            walls = [];
            scoreSpan.textContent = score;
            gameSpeed = 150;
            generateFood();
            cancelAnimationFrame(gameLoopId);
            gameLoopId = null;
            isGameOver = false;
            draw();
        }

        document.addEventListener('keydown', handleKeyPress);
        
        initGame();
    </script>
</body>
</html>
